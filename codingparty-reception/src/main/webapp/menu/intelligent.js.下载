define("nowcoder/1.2.900/javascripts/site/contest/intelligent",["nc","cpn","../../action/profile","../../util/ajax","../../core/siteConfig"],function(a){function b(){var a=this;a.isLogin=!!(window.globalInfo||{}).ownerId,a.tagMap={},a.tagContainer=o("#jsTagContainer"),a.form=o("#jsGoPractice").closest("form"),a.difficultyEl=o("#jsDifficultyShow"),a.tagShowEl=o("#jsTagsShow"),a.leftQuestionCount=0,a.initTagHtml(),a.initTagAction(),a.initDifficulty(),a.initCountChk(),a.initSourceChk()}function c(){var a=this,b=q.map(window.tags,function(b){var c=q.map(b.items,function(b){return a.tagMap[b.id]=b,t.execTpl(['<dd class="pop-interest-info nc-req-auth js-tag-item" data-id="#{id}">','<label class="checkbox">','<span class="icons"></span>','<div class="pop-interest-tit" title="#{title}">#{title}</div>',"</label>",'<div class="data-progress-bg">','<div class="data-progress-bar red-bar" style="width:#{progress}%;"></div>',"</div>",'<span class="data-progress-txt">#{rcount}/#{tcount}</span>',"</dd>"].join(""),{id:b.id,title:b.title,rcount:b.rcount,tcount:b.tcount,progress:0===b.tcount?0:b.rcount===b.tcount?100:100*b.rcount/b.tcount})}).join("");return t.execTpl(['<dl class="pop-interest-type">','<dt class="pop-interest-head">','<label class="checkbox nc-req-auth js-tag-all"><span class="icons"></span> 全选</label>',"<h2>#{title}</h2>","</dt>","#{item}","</dl>"].join(""),{title:b.title,item:c})}).join("");a.tagContainer.html(b)}function d(){var a=this,b=a.tagContainer;a.isLogin&&(b.on("click",".js-tag-all",function(b){b.preventDefault();var c=o(b.currentTarget),d=c.closest("dl"),e=c.hasClass("checked")?"removeClass":"addClass";c[e]("checked"),d.find("label.checkbox")[e]("checked"),a.changeAction()}),b.on("click",".js-tag-item",function(b){b.preventDefault();var c=o(b.currentTarget),d=c.closest("dl"),e=c.find("label.checkbox"),f=d.find("label.js-tag-all");if(c.attr("data-id")){if(e.hasClass("checked"))e.removeClass("checked"),f.removeClass("checked");else{e.addClass("checked");var g=!q.find(d.find(".js-tag-item label.checkbox"),function(a){return!o(a).hasClass("checked")});g&&f.addClass("checked")}a.changeAction()}}),o("#jsReSelect").on("click",function(){b.find("label.checked").removeClass("checked"),a.changeAction()}))}function e(){var a=this;a.difficulty=3,o("#jsDifficulty").on("mousemove",function(b){var c=o(b.currentTarget),d=b.clientX,e=c.offset().left,f=d-e,g=Math.max(1,Math.ceil(f/23));a.difficulty!==g&&(g=1>g?1:g>5?5:g,g=q.contains([1,2,3,4,5],g)?g:3,a.difficulty=g,c.removeClass().addClass("stars-choose star-"+g),a.changeAction())})}function f(){var a=this;a.countDv=o("#jsCountChk"),a.countChk=v.mix({el:a.countDv.find("label.radio"),listeners:{change:function(){a.lastSelectCount=window.parseInt(a.countChk.val(),10)||10,s.set("intelligentSelectCount",a.lastSelectCount,!0),a.changeAction()}}}),a.lastSelectCount=+s.get("intelligentSelectCount")||10}function g(){var a=this;a.sourceDv=o("#jsSourceChk"),a.sourceChk=v.mix({el:a.sourceDv.find("label.js-source-radio"),listeners:{change:function(){a.lastSelectSource=a.sourceChk.val(),s.set("intelligentSelectSource",a.lastSelectSource,!0),a.changeAction()}}}),a.lastSelectSource=s.get("intelligentSelectSource")||"1"}function h(a){var b=this;if(!b.isLogin)return void a.preventDefault();var c=b.getIds();return 0===c.length?(a.preventDefault(),u.alert("请先选择标签")):null===b.questionCount?(a.preventDefault(),u.alert("请先选择题目数量")):0===b.questionCount?(a.preventDefault(),u.alert("符合条件的题目数量不够组卷")):void 0}function i(){var a=this,b=0,c=a.getIds(),d=[];q.forEach(c,function(c){var e=a.tagMap[c];d.push(e.title),b+=e.leftcount}),a.tagShowEl.html(d.join(", ")),a.splitChar=0===d.length?"":" | ";var e=a.splitChar+("一二三四五".split("")[a.difficulty-1]||"三")+"星难度";if(a.difficultyEl.html(e),a.form.length>0){a.sourceDv[0===d.length?"hide":"show"](),a.sourceChk.val(a.lastSelectSource);var f=a.sourceChk.val(),g=r.addParam({source:f,tagIds:c.join(","),difficulty:a.difficulty},"/makePaper");a.form.attr("action",g),d.length>0&&(e+=" | "+("0"===f?"错题+新题":"1"===f?"只出新题":"2"===f?"只出错题":"不限来源"),a.difficultyEl.html(e)),a.questionCount=null,a.changeCount()}}function j(){function a(a){var c=b.getIds().join(",");if(d===c){var f=window.parseInt(b.countChk.val(),10)||10;if(f=b.getQuestionCount(f,a),b.countDv[10>a?"hide":"show"](),b.countChk.option[2].getEl()[20>a?"hide":"show"](),b.countChk.option[3].getEl()[30>a?"hide":"show"](),b.countChk.val(f+""),b.questionCount=f,f>0){e=b.sourceChk.val();var g=b.splitChar+("一二三四五".split("")[b.difficulty-1]||"三")+"星难度";g+=" | "+("0"===e?"错题+新题":"1"===e?"只出新题":"2"===e?"只出错题":"不限来源"),g+=" | "+f+"题",b.difficultyEl.html(g);var h=r.addParam({source:e,tagIds:c,difficulty:b.difficulty,questionCount:f},"/makePaper");b.form.attr("action",h)}}}var b=this,c=b.getIds();if(b.countDv.hide(),0!==c.length){b.countCache=b.countCache||{};var d=c.join(","),e=b.sourceChk.val();return e={0:"newAndWrongNum",1:"onlyNewNum",2:"onlyWrongNum"}[e]||"allNum",b.countCache[d]?void a(b.countCache[d][e]):void w.getIntelligentNumInfo({query:{tagIds:d},call:function(c){b.countCache[d]=c.data,a(c.data[e])},error:function(a){u.alert(a.msg)}})}}function k(a,b){var c=this;if(a=c.lastSelectCount||a,b>=a)return a;var d=b>=20?20:b>=10?10:b>=5?5:0,e=c.sourceChk.val();return"1"===e&&b>0&&(d=Math.max(d,5)),d}function l(){var a=this,b=a.tagContainer.find(".js-tag-item label.checkbox.checked"),c=[];return q.forEach(b,function(a){var b=o(a).closest(".js-tag-item"),d=b.attr("data-id");d&&c.push(d)}),c.sort(function(a,b){return+a-+b})}var m=a("nc"),n=a("cpn"),o=m.$,p=m.Sys,q=m.Base,r=m.Uri,s=m.Db,t=m.Str,u=n.Popup,v=n.CheckGroup,w=a("../../action/profile");p.ready({initialize:b,binds:{"click #jsGoPractice":h},initTagHtml:c,initTagAction:d,initDifficulty:e,initCountChk:f,initSourceChk:g,changeAction:i,changeCount:j,getQuestionCount:k,getIds:l})});