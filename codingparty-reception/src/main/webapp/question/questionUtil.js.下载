define("nowcoder/1.2.900/javascripts/site/question/questionUtil",["nc","cpn","../../action/contest","../../util/ajax","../../core/siteConfig","ncPlugin/highlighter/highlighter","../../util/littleAction","../../action/note"],function(a,b,c){function d(a){var b=this;b.lastLeft=0,b.isPause=!1,b.dragEl=y("div.full-separator"),b.topicDv=y("div.nowcoder-topic"),b.topicAnswerDv=y("div.nowcoder-topic-answer"),b.questionInfoIpt=y("#jsQuestionInfo"),b.canPauseTime=!!window.canPauseTime,b.initTestPing(),b.initTime(a.timeContainer,a.timeEl,a.isCountingUp),b.initCollect(),b.initShield(),b.dragEl.length>0&&b.initDragSplit(),I.init(),b.initShortCut(a.timeContainer),y("div.answer-sheet-box a.card-unfold").on("click",b.toggleFold),y("div.answer-sheet-box a.card-fold").on("click",b.toggleFold),y("div.answer-sheet-box")["1"===E.get("hideanswersheetbox")?"removeClass":"addClass"]("open"),y("div.synchronization").on("click",b.toggleSynchronization),"0"===E.get("nkSynchronization")&&(y("div.synchronization").removeClass("selected"),setTimeout(function(){y("#submitForm input[name=sync]").remove()},1e3)),b.initClickA(),y(document).on("click","ul.answer-sheet-num a",function(a){a.preventDefault();var b=y(a.currentTarget),c=b.attr("data-qid");window.nQFinish=1,y("#submitForm").append('<input type="hidden" name="nqid" value="'+c+'" />').submit()}),J.onlineJudgeHelp({el:y("a.js-click-help")}),b.initCheat(+window.questionInfo.type)}function e(){var a=this,b=window.questionInfo.tid;if(b){var c=!!window.isContest;window.setInterval(function(){a.isPause||(c?G.testContestPing({body:{testId:b}}):G.testPing({body:{testId:b}}))},6e4)}}function f(a){function b(a){a.preventDefault();var b=y("ul.answer-sheet-num a.answering-num").closest("li"),c=b.next();if(0!==c.length){var d=c.find("a"),e=d.attr("data-qid");window.nQFinish=1,y("#submitForm").append('<input type="hidden" name="nqid" value="'+e+'" />').submit()}}function c(a){a.preventDefault();var b=y("ul.answer-sheet-num a.answering-num").closest("li"),c=b.prev();if(0!==c.length){var d=c.find("a"),e=d.attr("data-qid");window.nQFinish=1,y("#submitForm").append('<input type="hidden" name="nqid" value="'+e+'" />').submit()}}var d=this;d.canPauseTime&&B.add("space",function(){d.isPause||d.toggleTiming(a)}),B.add("up",c),B.add("left",c),B.add("down",b),B.add("right",b)}function g(){var a=this;y("a").on("click",function(b){var c=y(b.currentTarget),d=c.attr("href");return C.isJsHref(d)||"0"===c.attr("data-prevent")?void 0:(b.preventDefault(),window.isLogin?void F.confirm("你本次试卷尚未提交，是否确定离开本页？",function(){window.location.href=d}):void new F({width:500,title:"提示",hasNoMove:!0,content:['<div class="confirm-content">','<div class="poptip-word">','<span class="warning-ico"></span>','<span class="warning-word">不想继续做题了吗？直接交卷后可以看正确答案哦！</span>',"</div>","</div>"].join(""),okTxt:"提前交卷",cancelTxt:"直接离开",listeners:{ok:function(){a.submitTest()},cancel:function(){window.location.href=d}}}))})}function h(a,b,c){var d=this,e=+b.data("left")||0,f=+b.data("time")||0,g=c?f:e;d.showTime(b,g,c),d.canPauseTime&&(a=y(a),a.on("click",function(){d.toggleTiming(a)}))}function i(a){var b=this;b.isPause=!b.isPause,a[b.isPause?"addClass":"removeClass"]("time-pause"),a.attr("title",b.isPause?"继续":"暂停");var c=b.questionInfoIpt,d=c.attr("data-tid");return b.isPause?(G.testStop({body:{testId:d}}),void new F({width:500,title:"提示",hasNoMove:!0,hasNoTitle:!0,content:['<div class="confirm-content">','<div class="poptip-word">','<span class="warning-ico"></span>','<span class="warning-word">休息一下吧！共 '+(c.attr("data-total")||"")+" 道题，还剩 "+(c.attr("data-left")||"")+" 道没做哦~</span>","</div>","</div>"].join(""),okTxt:"继续做题",cancelTxt:"下次再做",ok:function(){this.close(),b.toggleTiming(a)},cancel:function(){window.location.href="/"}})):void G.testRestart({body:{testId:d}})}function j(a,b,c){var d=this;if(!d.isPause){if(!c&&0>=b)return a.html("答题时间结束"),void d.submitTest();var e=D.second(b);a.html(e),a.css("font-size",e.length>8?"18px":"20px"),b=c?b+1:Math.max(0,b-1)}b>=0&&setTimeout(function(){d.showTime(a,b,c)},1e3)}function k(){var a=y(".js-follow");a=0===a.length?y(".js-unfollow"):a,J.follow({followCls:"js-follow",unfollowCls:"js-unfollow",followStr:"收藏本题",entityId:a.attr("data-id"),entityType:H.type.problem})}function l(a){var b=y(a.currentTarget).parent();b.toggleClass("open"),b.hasClass("open")?E.remove("hideanswersheetbox"):E.set("hideanswersheetbox","1")}function m(a){a.preventDefault();var b=y(a.currentTarget);b.hasClass("selected")?E.set("nkSynchronization","0"):E.remove("nkSynchronization")}function n(a){var b=this,c=y(document.body),d=y("div.nk-container"),e=y("div.nk-main"),f=y("div.nowcoder-topic"),g=y("div.nowcoder-topic-answer");if(a||void 0===a){E.set("questionFullScreen","1"),c.addClass("full-screen-body nk-body"),d.css("backgroundPositionX","35%"),d.css("backgroundPositionY","0"),e.addClass("full-screen-subject"),f.css("width",b.lastLeft?b.lastLeft:"35%"),b.setDragPos(f.width()+10),b.dragEl.show();var h=y(window).height();f.outerHeight(h),g.outerHeight(h),y(window).on("resize",b._winResizeCb=function(){var a=y(window).height();f.outerHeight(a),g.outerHeight(a),b.dragEl.height(a)})}else E.remove("questionFullScreen"),c.removeClass("full-screen-body nk-body"),e.removeAttr("style"),e.removeClass("full-screen-subject"),f.removeAttr("style"),g.removeAttr("style"),b.dragEl.hide(),f.height("auto"),g.height("auto"),b._winResizeCb&&(y(window).unbind("resize",b._winResizeCb),b._winResizeCb=null)}function o(){var a=this,b=a.dragEl;new A({drag:b,listeners:[{name:"start",handler:function(){this.offset=b.offset()}},{name:"drag",handler:function(){{var b=this,c=b.offset,d=c.left+b._moveX-b._downX;c.top+b._moveY-b._downY}a.setDragPos(d)}},{name:"drop",handler:function(){this.offset=null}}]})}function p(a){var b=this,c=b.dragEl,d=b.topicDv,e=b.topicAnswerDv,f=y(window).width();300>a&&(a=300),450>f-a&&(a=f-450),b.lastLeft=a;var g=100*a/f;c.css("marginLeft",g+"%"),c.css("height",y(window).height()),d.css("width",g-.8+"%"),e.css("marginLeft",g+"%"),e.css("width",100-g-2.8+"%")}function q(a){var b=this,c=window.questionInfo.tid,d=!!window.isContest;if(d){var e=+window.leaveCount||0;b.forbidRightMenu(),b.forbidSelect();var f=H.questionType;(a===f.danxuan||a===f.duoxuan||a===f.tiankong)&&(e>3&&(b.cheatAlerting=!0,F.alert("很遗憾，你离开当前考试页面的次数已经超过 3 次，系统将为你强制交卷，并记录违规行为。",function(){b.cheatAlerting=!1,b.submitTest()})),b.forbidBurWindow(function(){b.cheatAlerting||(G.addLeave({body:{testId:c}}),e++,e>3?(b.cheatAlerting=!0,F.alert("很遗憾，你离开当前考试页面的次数已经超过 3 次，系统将为你强制交卷，并记录违规行为。",function(){b.cheatAlerting=!1,b.submitTest()})):(b.cheatAlerting=!0,F.alert("你已离开当前页面 "+e+" 次，客观题部分离开超过 3 次将无法继续考试。",function(){b.cheatAlerting=!1})))}))}}function r(){y(document).on("contextmenu",function(){return!1}).on("click",function(a){3===a.witch&&a.preventDefault()})}function s(){y(document).on("selectstart",function(){return!1}),y(document.body).css("-moz-user-select","none")}function t(a){var b=null,c=!0,d=z.ie(),e=1e4;y(window).blur(function(){return d&&8>=d&&c?void(c=!1):(b&&window.clearTimeout(b),void(b=window.setTimeout(function(){a&&a()},e)))}),y(window).focus(function(){b&&window.clearTimeout(b),b=null})}function u(){window.nQFinish=1,y("#submitForm").append('<input type="hidden" name="finish" value="1" />').submit()}function v(){var a=y(".js-shield");a=0===a.length?y(".js-unshield"):a,J.shieldQuestion({shieldCls:"js-shield",unShieldCls:"js-unshield",shieldStr:"屏蔽本题",shieldedStr:"取消屏蔽",entityId:a.attr("data-id")})}var w=a("nc"),x=a("cpn"),y=w.$,z=w.Browser,A=(w.Limit,w.DragDrop),B=w.ShortCut,C=w.Str,D=w.Time,E=w.Db,F=x.Popup,G=(w.Dom,a("../../action/contest")),H=a("../../core/siteConfig"),I=a("ncPlugin/highlighter/highlighter"),J=a("../../util/littleAction");c.exports={init:d,initTime:h,initCollect:k,initClickA:g,initTestPing:e,initShortCut:f,initShield:v,toggleTiming:i,showTime:j,toggleFold:l,toggleSynchronization:m,gotoFullScreen:n,initDragSplit:o,setDragPos:p,initCheat:q,forbidRightMenu:r,forbidSelect:s,forbidBurWindow:t,submitTest:u}});